openapi: "3.0.3"

info:
  version: 0.7.x
  title: "uhppoted"
  description: "REST API for the uhppoted-rest service. The API currently supports both device level functions and higher level access control list management."
  license:
    name: "MIT"
    url: "https://github.com/uhppoted/uhppoted/blob/master/LICENSE"
    
servers:    
  - url: "http://127.0.0.1:8080/uhppote"
  - url: "https://127.0.0.1:8443/uhppote"
  
tags:
  - name: "device"
    description: "Low level device API"
  - name: "acl"
    description: "Access control list API"

security:
  - basic: []
  - hotp: []

paths:
  /device:
    get:
      tags:
        - device
      summary: "Retrieves a list of active devices"
      description: "Retrieves the list of active UHPPOTE devices"
      operationId: listDevices
      responses:
        '200':
          description: "List of active devices"
          content:
            application/json:
              schema:
                  $ref: "./schemas/DeviceList.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}:
    get:
      tags:
        - device
      summary: "Retrieves a single device information"
      description: "Retrieves the basic configuration for a UHPPOTE device"
      operationId: getDevice
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Device configuration"
          content:
            application/json:
              schema:
                type: object
                properties:
                  device:
                    $ref: "./schemas/Device.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
          
  /device/{device-id}/status:
    get:
      tags:
        - device
      summary: "Retrieves the device status"
      description: "Retrieves the current status of a device"
      operationId: getDeviceStatus
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Device current status"
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: "./schemas/DeviceStatus.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/time:
    get:
      tags:
        - device
      summary: "Retrieves the device time"
      description: "Retrieves the device current date/time"
      operationId: getDeviceTime
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Device current date/time"
          content:
            application/json:
              schema:
                  $ref: "./schemas/DeviceTime.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

    put:
      tags:
        - device
      summary: "Sets the device time"
      description: "Sets the device current date/time"
      operationId: putDeviceTime
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      requestBody:
        description: "Date time"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/DeviceTime.yaml"
      responses:
        '200':
          description: "Device current date/time"
          content:
            application/json:
              schema:
                  $ref: "./schemas/DeviceTime.yaml"
        '403':
          description: "Access denied"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/door/{door}:
    get:
      tags:
        - device
      summary: "Retrieves the door configuration"
      description: "Retrieves the door delay setting and current control state"
      operationId: getDoor
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: door
          in: path
          description: "Door number"
          required: true
          schema:
            type: integer
            format: uint8
            example: 3
      responses:
        '200':
          description: "Door delay (in seconds)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  door:
                    $ref: "./schemas/Door.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/door/{door}/swipes:
    post:
      tags:
        - device
      summary: "Opens a door"
      description: "Issues the 'open door' command to an access controller"
      operationId: openDoor
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: number
            format: uint32
            example: 405419896
        - name: door
          in: path
          description: "Door number"
          required: true
          schema:
            type: number
            format: uint8
            example: 3
      requestBody:
        content:
          application/json:
            schema:
              $ref: './schemas/CardSwipe.yaml'
      responses:
        '200':
          description: "Door opened"
          content:
            application/json:
              schema:
                type: object
                properties:
                  door:
                    $ref: "./schemas/DoorOpened.yaml"
        '401':
          description: "User does not have permssions to open door"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/door/{door}/delay:
    put:
      tags:
        - device
      summary: "Sets the door delay"
      description: "Sets the door delay in seconds"
      operationId: putDoorDelay
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: door
          in: path
          description: "Door number"
          required: true
          schema:
            type: integer
            format: uint8
            example: 3
      requestBody:
        description: "Door delay in seconds"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/DoorDelay.yaml"
      responses:
        '200':
          description: "Door delay in seconds"
          content:
            application/json:
              schema:
                  $ref: "./schemas/DoorDelay.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/door/{door}/control:
    put:
      tags:
        - device
      summary: "Sets the door control state"
      description: "Sets the door control state (normally open, normally closed or controlled"
      operationId: putDoorControlState
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: door
          in: path
          description: "Door number"
          required: true
          schema:
            type: integer
            format: uint8
            example: 3
      requestBody:
        description: "Door control state"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/DoorControlState.yaml"
      responses:
        '200':
          description: "Door control state"
          content:
            application/json:
              schema:
                  $ref: "./schemas/DoorControlState.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/cards:
    get:
      tags:
        - device
      summary: "Retrieves the device card list"
      description: "Retrieves the list of stored card numbers"
      operationId: getCards
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Card list"
          content:
            application/json:
              schema:
                  $ref: "./schemas/CardList.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

    delete:
      tags:
        - device
      summary: "Deletes the entire device card list"
      description: "Deletes all stored card numbers"
      operationId: deleteCards
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Stored card list cleared"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/card/{card-number}:
    get:
      tags:
        - device
      summary: "Retrieves card access information"
      description: "Retrieves the access permissions associated with a card number"
      operationId: getCard
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 192837465
      responses:
        '200':
          description: "Card access information"
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: "./schemas/Card.yaml"
        '404':
          description: "No matching device and/or card"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

    put:
      tags:
        - device
      summary: "Adds or updates a card"
      description: "Adds or updates the access permissions associated with a card number"
      operationId: putCard
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 192837465
      requestBody:
        description: "Card valid dates and access permissions"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/CardDetails.yaml"
      responses:
        '200':
          description: "Card details added/updated"
        '404':
          description: "No matching device and/or card"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

    delete:
      tags:
        - device
      summary: "Deletes a card"
      description: "Removes the card associated with the card number from the stored card list"
      operationId: deleteCard
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 192837465
      responses:
        '200':
          description: "Card deleted"
        '404':
          description: "No matching device and/or card"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/time-profiles:
    delete:
      tags:
        - device
      summary: "Deletes all time profiles"
      description: "Deletes all time profiles from a controller"
      operationId: clearTimeProfiles
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Time profiles cleared"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/time-profile/{time-profile-id}:
    get:
      tags:
        - device
      summary: "Retrieves a time profile"
      description: "Retrieves a time profile from a controller"
      operationId: getDeviceTimeProfile
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: time-profile-id
          in: path
          description: "Time profile ID in the interval [2..254]"
          required: true
          schema:
            type: integer
            format: uint8 
            example: 29
      responses:
        '200':
          description: "Time profile defined for the time-profile-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/TimeProfile.yaml"
        '404':
          description: "No time profile defined for device-id + time-profile-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
              example: {
                  tag: "get-time-profile",
                  message: "Time profile 29 not found"
              }
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
    
    put:
      tags:
        - device
      summary: "Adds or updates a time profile"
      description: "Adds or updates a controller time profile"
      operationId: putTimeProfile
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: time-profile-id
          in: path
          description: "Time profile ID in the interval [2..254]"
          required: true
          schema:
            type: integer
            format: uint8 
            example: 29
      requestBody:
        description: "Time profile definition"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/TimeProfile.yaml"
      responses:
        '200':
          description: "Time profile added/updated"
        '404':
          description: "No matching device"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/events:
    get:
      tags:
        - device
      summary: "Retrieves the device event list indices"
      description: "Retrieves the indices of the first and last stored events"
      operationId: getEvents
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      responses:
        '200':
          description: "Event list"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Events.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/event/{event-id}:
    get:
      tags:
        - device
      summary: "Retrieves a single event record"
      description: "Retrieves the event record for an event ID"
      operationId: getEvent
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
        - name: event-id
          in: path
          description: "Event ID"
          required: true
          schema:
            type: integer
            format: uint32
            example: 31
      responses:
        '200':
          description: "Event record"
          content:
            application/json:
              schema:
                type: object
                properties:
                  event:
                    $ref: "./schemas/Event.yaml"
        '404':
          description: "No matching device and/or event"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /device/{device-id}/special-events:
    put:
      tags:
        - device
      summary: "Enable or disable special events"
      description: "Enables or disables events on door open, door closed and door button pressed"
      operationId: putRecordSpecialEvents
      parameters:
        - name: device-id
          in: path
          description: "Device serial number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 405419896
      requestBody:
        description: "Enable/disable special events"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/SpecialEvents.yaml"
            examples:
              enable: 
                value:
                  enabled: true
              disable: 
                value:
                  enabled: false

      responses:
        '200':
          description: "Device record special events"
          content:
            application/json:
              schema:
                  $ref: "./schemas/SpecialEvents.yaml"
        '403':
          description: "Access denied"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '404':
          description: "No device with ID matching device-id"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        
  /acl:
    get:
      tags:
        - acl
      summary: "Retrieves an access control list from a set of controllers"
      description: "Retrieves and consolidates the card lists from a set of controllers into a list of access permissions associated with each card."
      operationId: aclGet
      responses:
        '200':
          description: "Consolidated access control lists"
          content:
            application/json:
              schema:
                $ref: "./schemas/ACL.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
  
    put:
      tags:
        - acl
      summary: "Loads an access control list to a set of controllers"
      description: "Updates the cards on a set of controllers from an access control list that specifies the access permissions for all users."
      operationId: aclPut
      requestBody:
        description: "Access control list"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/ACL.yaml"
      responses:
        '200':
          description: "Result of access control lists update"
          content:
            application/json:
              schema:
                  $ref: "./schemas/PutACLResult.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        
  /acl/card/{card-number}:
    get:
      tags:
        - acl
      summary: "Retrieves the access permissions for a card"
      description: "Retrieves the access permissions for a card, using the configuration to resolve the door ID to the controller + door number."
      operationId: aclShow
      parameters:
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 192837465
      responses:
        '200':
          description: "List of current card access permissions"
          content:
            application/json:
              schema:
                  $ref: "./schemas/CardPermissions.yaml"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

  /acl/card/{card-number}/door/{door}:
    put:
      tags:
        - acl
      summary: "Grants a card access to a door"
      description: "Grants a card access to a single named door, using the configuration to resolve the door ID to the controller + door number. A granted access is added to the existing permissions for the card and access dates are widened to accommodate the earliest start date and the latest end date. The ALL door will grant access to all configured doors."
      operationId: aclGrantDoor
      parameters:
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32รฅรง
            example: 192837465
        - name: door
          in: path
          description: "Door ID ('ALL' will grant access to all doors)"
          required: true
          explode: true
          schema:
            type: string
            format: Alphanumeric door name (space- and case-insensitive).
            example: "Entrance"
      requestBody:
        description: "Card valid dates"
        required: true
        content:
          application/json:
            schema:
              $ref: "./schemas/DateRange.yaml"
      responses:
        '200':
          description: "Access granted"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

    delete:
      tags:
        - acl
      summary: "Revokes a card access to a door"
      description: "Revokes a card's access to a door, using the configuration to resolve the door ID to the controller + door number. A revoked access is removed from the existing permissions for the card without modifying the card start/end dates or removing the card from the controllers' internal lists."
      operationId: aclRevokeDoor
      parameters:
        - name: card-number
          in: path
          description: "Card number"
          required: true
          schema:
            type: integer
            format: uint32
            example: 192837465
        - name: door
          in: path
          description: "Door ID ('ALL' will revoke access to all doors)"
          required: true
          explode: true
          schema:
            type: string
            format: Alphanumeric door name (space- and case-insensitive).
            example: "Entrance"
      responses:
        '200':
          description: "Access revoked"
        '405':
          description: "Invalid request"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"
        '500':
          description: "Internal system error"
        default:
          description: "Request failed"
          content:
            application/json:
              schema:
                  $ref: "./schemas/Error.yaml"

components:
  securitySchemes:
    basic:
      type: http
      scheme: basic
      description: "RFC 2617 user:password credentials"
    hotp:
      type: http
      scheme: bearer
      bearerFormat: HOTP:user-id:OTP, base64 encoded
      description: "Lightweight user:OTP authorization scheme for IOT devices"
      
  schemas:
      $ref: "./schemas/_index.yaml"